FROM ecommerce-app:latest AS builder
WORKDIR /app

COPY pom.xml .
COPY base-framework ./base-framework
COPY microservices ./microservices
COPY infra-services ./infra-services

RUN mvn -pl infra-services/api-gateway -am clean package -DskipTests

FROM eclipse-temurin:17-jre
WORKDIR /app

COPY --from=builder /app/infra-services/api-gateway/target/api-gateway-*.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
